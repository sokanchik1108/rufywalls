@foreach($variants as $variant)
@php
$product = $variant->product;
$images = json_decode($variant->images ?? '[]', true);
@endphp

<div class="col-6 col-sm-4 col-md-3 col-lg-2">
    <div class="card h-100">
        @if(!empty($images))
        <img src="{{ asset('storage/' . $images[0]) }}" class="card-img-top" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" loading="lazy">
        @endif

        <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ: {{ $product->name }}</h5>
            <h5 class="card-title mb-1 text-primary">–ê—Ä—Ç–∏–∫—É–ª: {{ $variant->sku }}</h5>
            <p class="text-muted mb-2">–û—Ç—Ç–µ–Ω–æ–∫: <strong>{{ $variant->color }}</strong></p>

            <p class="mb-1"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong>
                {{ $product->categories->pluck('category_name')->implode(', ') ?: '‚Äî' }}
            </p>
            <p class="mb-1"><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ $product->status }}</p>
            <p class="mb-1"><strong>–ë—Ä–µ–Ω–¥:</strong> {{ $product->brand }}</p>
            <p class="mb-1"><strong>–°—Ç—Ä–∞–Ω–∞:</strong> {{ $product->country }}</p>
            <p class="mb-1"><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> {{ $product->material }}</p>
            <p class="mb-1"><strong>–¶–µ–Ω–∞ –ø—Ä–∏—Ö–æ–¥–∞:</strong> {{ $product->purchase_price }}</p>
            <p class="mb-1"><strong>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:</strong> {{ $product->sale_price }}</p>
            <p class="mb-1"><strong>–†–∞–ø–ø–æ—Ä—Ç:</strong> {{ $product->sticking }}</p>
            <p class="mb-1"><strong>–û—Å—Ç–∞—Ç–æ–∫:</strong> {{ $variant->total_stock ?? 0 }} —à—Ç.</p>

            <p class="mb-2"><strong>–ö–æ–º–Ω–∞—Ç—ã:</strong><br>
                @foreach($product->rooms as $room)
                <span class="badge badge-room">{{ $room->room_name }}</span>
                @endforeach
            </p>

            @if($variant->companions->isNotEmpty())
            <div class="mt-2">
                <p class="mb-1"><strong>–ö–æ–º–ø–∞–Ω—å–æ–Ω—ã:</strong></p>
                <ul class="small ps-3">
                    @foreach($variant->companions as $companion)
                    <li>
                        {{ $companion->product->name }}
                        ‚Äî {{ $companion->sku }}
                        @if($companion->color)
                        ({{ $companion->color }})
                        @endif
                    </li>
                    @endforeach
                </ul>
            </div>
            @endif



            <p class="mb-3"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>{{ $product->description }}</p>

            <div class="mt-auto">
                <div class="d-grid gap-2">
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
                    <button class="btn btn-sm btn-outline-primary w-100" data-bs-toggle="modal"
                        data-bs-target="#editModal{{ $variant->id }}">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>

                    <!-- –£–¥–∞–ª–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç -->
                    <form action="{{ route('admin.variant.delete', $variant->id) }}" method="POST"
                        onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç?')">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-sm btn-outline-danger w-100">
                            ‚ùå –£–¥–∞–ª–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
                        </button>
                    </form>

                    <!-- –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä -->
                    <form action="{{ route('admin.products.destroy', $product->id) }}" method="POST"
                        onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å —Ç–æ–≤–∞—Ä —Å–æ –≤—Å–µ–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏?')">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-sm btn-danger w-100">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
                        </button>
                    </form>


                    <!-- –°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä -->
                    <form action="{{ route('admin.products.toggle-hidden', $product->id) }}" method="POST" class="mt-2">
                        @csrf
                        @method('PATCH')

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="is_hidden" id="hideProduct{{ $product->id }}"
                                onchange="this.form.submit()" {{ $product->is_hidden ? 'checked' : '' }}>
                            <label class="form-check-label" for="hideProduct{{ $product->id }}">
                                üîí –°–∫—Ä—ã—Ç—å —Ç–æ–≤–∞—Ä
                            </label>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
@include('admin.partials.variant-edit-modal', [
'variant' => $variant,
'product' => $product,
'images' => $images,
'categories' => $categories,
'rooms' => $rooms,
])
@endforeach

@if ($variants->hasPages())
<div class="mt-4 d-flex justify-content-center">
    {{ $variants->links('vendor.pagination.custom') }}
</div>
@endif